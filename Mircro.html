<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heti | Monitoring Environment</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(226, 232, 240, 0.8);
        }

        input[type="range"] {
            accent-color: #000;
            height: 6px;
        }

        .stat-card {
            transition: transform 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
        }

        .custom-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }

        .tab-active {
            color: #000 !important;
            border-bottom: 2px solid #000;
        }

        .hidden-section {
            display: none !important;
        }

        .formula-box {
            background: #f1f5f9;
            border-left: 4px solid #000;
            padding: 1rem;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 0.875rem;
            margin: 1rem 0;
            border-radius: 0 0.5rem 0.5rem 0;
        }
        
        .concept-card {
            border: 1px solid #f1f5f9;
            padding: 1.5rem;
            border-radius: 1rem;
            background: #fff;
        }

        .physics-tag {
            background: #e2e8f0;
            color: #475569;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .control-layer {
            border-left: 2px solid #e2e8f0;
            padding-left: 1.5rem;
            position: relative;
        }
        .control-layer::before {
            content: '';
            position: absolute;
            left: -5px;
            top: 0;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #cbd5e1;
        }

        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 12px; font-size: 11px; color: #64748b; border-bottom: 2px solid #f1f5f9; text-transform: uppercase; }
        td { padding: 12px; font-size: 13px; border-bottom: 1px solid #f1f5f9; }
    </style>
</head>
<body class="h-screen overflow-hidden flex flex-col">

    <!-- Header -->
    <header class="h-16 border-b bg-white flex items-center justify-between px-6 shrink-0 z-50">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-black rounded flex items-center justify-center text-white font-bold">H</div>
            <div>
                <h1 class="text-lg font-bold tracking-tight">Heti</h1>
            </div>
        </div>
        
        <!-- Navigation Tabs -->
        <nav class="flex h-full gap-8">
            <button onclick="switchTab('concept')" id="tab-concept" class="h-full px-2 text-xs font-bold uppercase tracking-widest transition tab-active">
                Concept
            </button>
            <button onclick="switchTab('simulation')" id="tab-simulation" class="h-full px-2 text-xs font-bold uppercase tracking-widest text-gray-400 hover:text-gray-600 transition">
                Simulation
            </button>
        </nav>

        <div class="flex items-center gap-4">
            <div id="status-pill" class="px-3 py-1 rounded-full bg-slate-100 text-slate-600 text-[10px] font-bold flex items-center gap-2">
                <span class="relative flex h-2 w-2">
                    <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-slate-400 opacity-75"></span>
                    <span class="relative inline-flex rounded-full h-2 w-2 bg-slate-500"></span>
                </span>
                SYSTEM READY
            </div>
        </div>
    </header>

    <!-- Content Area -->
    <main class="flex-1 relative overflow-hidden bg-slate-50">
        
        <!-- SECTION: CONCEPT -->
        <div id="section-concept" class="h-full overflow-y-auto bg-white custom-scroll">
            <div class="max-w-5xl mx-auto p-12">
                <header class="mb-12 border-b pb-8">
                    <h2 class="text-4xl font-extrabold text-slate-900 mb-4 tracking-tight">Operational Theory</h2>
                    <p class="text-lg text-slate-500 leading-relaxed">A deep dive into Heti's forecasting, physics engines, and the Microgrid Controller logic.</p>
                </header>

                <div class="space-y-16">
                    <!-- 1. Solar Power Forecasting -->
                    <section>
                        <div class="flex items-center gap-3 mb-6">
                            <div class="w-10 h-10 rounded-lg bg-amber-100 text-amber-600 flex items-center justify-center font-bold text-lg">1</div>
                            <h3 class="text-2xl font-bold text-slate-800">Solar Power Forecasting: Beyond Irradiance</h3>
                        </div>
                        <p class="text-slate-600 mb-6 leading-relaxed">While irradiance is the "fuel," the actual output is a result of complex energy conversion. Heti utilizes a Hybrid Approach:</p>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="concept-card">
                                <h4 class="font-bold text-slate-900 mb-2">Statistical Refinement</h4>
                                <p class="text-xs text-slate-500 leading-relaxed">Systems use Model Output Statistics (MOS) to correct bias—learning if local topography causes a site to be sunnier than regional NWP models suggest.</p>
                            </div>
                            <div class="concept-card">
                                <h4 class="font-bold text-slate-900 mb-2">Sky Imagers & Optical Flow</h4>
                                <p class="text-xs text-slate-500 leading-relaxed">For intra-hour "Next 15 Minutes," local cameras analyze cloud vectors. For 24h horizons, we transition to satellite Cloud Motion Vectors (CMV).</p>
                            </div>
                            <div class="concept-card">
                                <h4 class="font-bold text-slate-900 mb-2">The Soiling Factor</h4>
                                <p class="text-xs text-slate-500 leading-relaxed">Includes a "soiling loss" variable, using local humidity and dust sensors to predict degradation before the next scheduled rain or cleaning.</p>
                            </div>
                        </div>
                    </section>

                    <!-- 2. Wind Power Forecasting -->
                    <section>
                        <div class="flex items-center gap-3 mb-6">
                            <div class="w-10 h-10 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center font-bold text-lg">2</div>
                            <h3 class="text-2xl font-bold text-slate-800">Wind Power Forecasting: Navigating Non-Linearity</h3>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div>
                                <p class="text-sm text-slate-600 mb-4">Wind is notoriously difficult because of the <b>Cubic Relationship</b>: power is proportional to the cube of wind speed. A 10% error in speed prediction can lead to a 30% error in power.</p>
                                <div class="formula-box text-center uppercase tracking-wider">Wind Power = 0.5 × Air Density × Area × Wind Speed³ × Efficiency</div>
                            </div>
                            <div class="space-y-4">
                                <div class="p-4 bg-slate-50 rounded-xl border">
                                    <h4 class="font-bold text-xs uppercase text-slate-400 mb-1">Ramp Event Detection</h4>
                                    <p class="text-xs text-slate-600">Uses <b>Ensemble Forecasting</b> (20–50 simulations) to predict sudden, violent shifts in wind speed.</p>
                                </div>
                                <div class="p-4 bg-slate-50 rounded-xl border">
                                    <h4 class="font-bold text-xs uppercase text-slate-400 mb-1">Wake Effect Modeling</h4>
                                    <p class="text-xs text-slate-600">Accounts for turbulence where front turbines "steal" wind from those behind them as directions shift.</p>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- 3. Load (Demand) Forecasting -->
                    <section>
                        <div class="flex items-center gap-3 mb-6">
                            <div class="w-10 h-10 rounded-lg bg-rose-100 text-rose-600 flex items-center justify-center font-bold text-lg">3</div>
                            <h3 class="text-2xl font-bold text-slate-800">Load Forecasting: The Human Element</h3>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                            <div class="space-y-6">
                                <div>
                                    <h4 class="font-bold text-slate-900 mb-2">Feature Engineering</h4>
                                    <p class="text-sm text-slate-500">Goes beyond "Monday vs Sunday." We track <b>Recency Effects</b> (thermal mass from previous hot days) and <b>Calendar Events</b> (school holidays, sports).</p>
                                </div>
                                <div>
                                    <h4 class="font-bold text-slate-900 mb-2">BTM Solar Disaggregation</h4>
                                    <p class="text-sm text-slate-500">Calculates how much of a load drop is due to customer solar vs. people actually leaving the building.</p>
                                </div>
                            </div>
                            <div class="bg-slate-900 text-white p-8 rounded-3xl shadow-xl">
                                <h4 class="text-emerald-400 font-bold mb-4 uppercase tracking-widest text-xs">The Intelligence Layer</h4>
                                <h5 class="text-xl font-bold mb-4">LSTM (Long Short-Term Memory)</h5>
                                <p class="text-sm text-slate-400 leading-relaxed mb-6">Unlike standard neural networks, LSTMs maintain "memory" of previous hours' trends, allowing the system to identify subtle behavioral patterns that precede consumption spikes.</p>
                                <div class="flex gap-2">
                                    <span class="px-2 py-1 bg-slate-800 rounded text-[10px] font-bold">RECURRENT NN</span>
                                    <span class="px-2 py-1 bg-slate-800 rounded text-[10px] font-bold">TIME-SERIES</span>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- 4. The Control Hierarchy -->
                    <section class="border-t pt-16">
                        <div class="flex items-center gap-3 mb-6">
                            <div class="w-10 h-10 rounded-lg bg-violet-100 text-violet-600 flex items-center justify-center font-bold text-lg">4</div>
                            <h3 class="text-2xl font-bold text-slate-800">The Control Hierarchy: Three Levels of Logic</h3>
                        </div>
                        <p class="text-slate-600 mb-8 leading-relaxed">To ensure both economic efficiency and electrical survival, the decision-making is split into three layers:</p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
                            <div class="control-layer">
                                <h4 class="font-bold text-slate-900 mb-1">Tertiary Control</h4>
                                <span class="text-[10px] font-bold text-violet-600 uppercase">The Economic Brain (EMS)</span>
                                <p class="text-xs text-slate-500 mt-2">Looks hours ahead. Sets the "Schedule."</p>
                                <p class="text-xs text-slate-700 italic mt-2">"Charge to 90% at 2 PM solar peak; discharge at 6 PM peak prices."</p>
                            </div>
                            <div class="control-layer">
                                <h4 class="font-bold text-slate-900 mb-1">Secondary Control</h4>
                                <span class="text-[10px] font-bold text-blue-600 uppercase">The Balancing Brain</span>
                                <p class="text-xs text-slate-500 mt-2">Reacts in seconds to forecasting errors or cloud transients.</p>
                                <p class="text-xs text-slate-700 italic mt-2">"Solar dropped unexpectedly; discharge battery NOW to keep frequency stable."</p>
                            </div>
                            <div class="control-layer">
                                <h4 class="font-bold text-slate-900 mb-1">Primary Control</h4>
                                <span class="text-[10px] font-bold text-emerald-600 uppercase">The Survival Brain (Inverter)</span>
                                <p class="text-xs text-slate-500 mt-2">Droop Control. Millisecond reaction to electrical physics.</p>
                                <p class="text-xs text-slate-700 italic mt-2">"Voltage dropping too fast—push power out or system will crash."</p>
                            </div>
                        </div>

                        <div class="bg-slate-50 border p-8 rounded-3xl">
                            <h4 class="text-slate-900 font-bold mb-4 uppercase tracking-widest text-xs">The Core Logic: The Optimization Engine</h4>
                            <p class="text-sm text-slate-600 mb-4 leading-relaxed">
                                The EMS uses <b>Mixed-Integer Linear Programming (MILP)</b> to solve a massive multi-variable equation every few minutes. It evaluates four key data vectors:
                            </p>
                            <ul class="grid grid-cols-1 md:grid-cols-2 gap-4 text-xs">
                                <li class="flex gap-3 items-start"><span class="w-1.5 h-1.5 rounded-full bg-slate-400 mt-1.5"></span> <div><b>Forecasting:</b> Is a storm coming? <br>If yes, keep the battery full.</div></li>
                                <li class="flex gap-3 items-start"><span class="w-1.5 h-1.5 rounded-full bg-slate-400 mt-1.5"></span> <div><b>Physics:</b> Is the battery too hot? <br>If yes, limit discharge.</div></li>
                                <li class="flex gap-3 items-start"><span class="w-1.5 h-1.5 rounded-full bg-slate-400 mt-1.5"></span> <div><b>Market Data:</b> Is electricity expensive right now? <br>If yes, discharge.</div></li>
                                <li class="flex gap-3 items-start"><span class="w-1.5 h-1.5 rounded-full bg-slate-400 mt-1.5"></span> <div><b>Load Demand:</b> Is heavy machinery starting? <br>If yes, discharge.</div></li>
                            </ul>
                        </div>
                    </section>

                    <!-- 5. The Optimization Loop -->
                    <section class="border-t pt-16">
                        <div class="flex items-center gap-3 mb-6">
                            <div class="w-10 h-10 rounded-lg bg-emerald-100 text-emerald-600 flex items-center justify-center font-bold text-lg">5</div>
                            <h3 class="text-2xl font-bold text-slate-800">The Optimization Loop: How It Decides</h3>
                        </div>
                        <p class="text-slate-600 mb-8 leading-relaxed">Forecasts are fed into a Microgrid Controller performing <b>Economic Dispatch</b> via <b>Model Predictive Control (MPC)</b>. The goal is to minimize a "Cost Function":</p>
                        
                        <div class="bg-slate-900 rounded-3xl p-8 text-white mb-10">
                            <h4 class="text-emerald-400 font-bold mb-4 uppercase tracking-widest text-xs">The Objective Function</h4>
                            <p class="text-lg text-slate-200 mb-6 font-semibold text-center py-4">Total Cost = Fuel Cost + Grid Power Cost + Battery Wear Penalty</p>
                            <p class="text-sm text-slate-300 leading-relaxed">
                                <b>Logic Example:</b> If the <b>Battery Wear Penalty</b> (degradation cost) is $0.15/kWh, and the <b>Grid Power Cost</b> is $0.20/kWh, the engine will decide to discharge. If the grid price drops to $0.05/kWh, the engine stops discharging and starts charging from the grid instead.
                            </p>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-10">
                            <div class="p-6 bg-emerald-50 rounded-2xl border border-emerald-100">
                                <h4 class="font-bold text-emerald-800 mb-2">Multi-Objective Optimization</h4>
                                <p class="text-xs text-emerald-700 leading-relaxed">The controller assigns a "dollar per % of health" value to degradation. It switches sources based on the intersection of physical health costs and market pricing.</p>
                            </div>
                            <div class="p-6 bg-slate-50 rounded-2xl border border-slate-200">
                                <h4 class="font-bold text-slate-800 mb-2">Rolling Horizon</h4>
                                <p class="text-xs text-slate-600 leading-relaxed">The system re-forecasts every 15 minutes. It constantly shifts between binary decisions (Gen ON/OFF) and continuous power flow variables.</p>
                            </div>
                        </div>
                    </section>

                    <!-- 6. Advanced Component Physics -->
                    <section class="border-t pt-16">
                        <div class="flex items-center gap-3 mb-6">
                            <div class="w-10 h-10 rounded-lg bg-indigo-100 text-indigo-600 flex items-center justify-center font-bold text-lg">6</div>
                            <div>
                                <h3 class="text-2xl font-bold text-slate-800">Advanced Component Physics</h3>
                                <h4 class="text-sm font-medium text-slate-500 italic mt-1">
                                    Modeling internal stress, thermal inertia, and switching losses.
                                </h4>
                            </div>
                        </div>
                        
                        <div class="space-y-12 mt-10">
                            <!-- Battery Degradation -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-10 items-start">
                                <div>
                                    <div class="flex items-center gap-2 mb-4">
                                        <span class="physics-tag">Electro-Chemistry</span>
                                        <h5 class="font-bold text-slate-900">Battery Aging & Stress Dynamics</h5>
                                    </div>
                                    <p class="text-sm text-slate-600 leading-relaxed mb-4">
                                        Heti uses <b>Equivalent Circuit Models (ECM)</b> to simulate the battery's "pulse." Degradation is modeled through <b>SEI (Solid Electrolyte Interphase) Layer Growth</b>—high temperatures and extreme SoC levels permanently trap lithium ions in the anode crust.
                                    </p>
                                    <div class="p-4 bg-slate-50 rounded-xl border-l-4 border-slate-400">
                                        <p class="text-[11px] text-slate-500 font-mono"><b>State of Health (SoH):</b> Tracked via Extended Kalman Filters (EKF) comparing predicted vs. measured voltage.</p>
                                    </div>
                                </div>
                                <div class="space-y-4">
                                    <div class="p-4 border rounded-xl bg-white shadow-sm">
                                        <h6 class="text-[10px] font-bold text-indigo-600 uppercase">The Temperature-C-Rate Nexus</h6>
                                        <p class="text-xs text-slate-700 mt-1">Discharging at 2C creates exponential internal heat (Heat loss = I^2 R), accelerating chemical breakdown.</p>
                                    </div>
                                    <div class="p-4 border rounded-xl bg-white shadow-sm">
                                        <h6 class="text-[10px] font-bold text-indigo-600 uppercase">Ion Diffusion Limits</h6>
                                        <p class="text-xs text-slate-700 mt-1">C-Rate limiting prevents "dumping" power too fast when internal resistance is high (e.g., cold batteries).</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Diesel Fuel Curves -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-10 items-start border-t pt-10">
                                <div>
                                    <div class="flex items-center gap-2 mb-4">
                                        <span class="physics-tag">Thermodynamics</span>
                                        <h5 class="font-bold text-slate-900">Diesel Transient Physics</h5>
                                    </div>
                                    <p class="text-sm text-slate-600 leading-relaxed mb-4">
                                        Beyond the quadratic <b>BSFC fuel curve</b> (P = aP^2 + bP + c), Heti models <b>Thermal Inertia</b>. Cold starts consume 15% more fuel until the engine block reaches optimal thermal equilibrium (~85°C).
                                    </p>
                                    <div class="p-4 bg-amber-50 rounded-xl border border-amber-100">
                                        <p class="text-[11px] text-amber-800"><b>Spinning Reserves:</b> Maintains specific RPM to provide "virtual inertia" to counter solar drop-offs (clouds).</p>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 gap-4">
                                    <div class="flex gap-4">
                                        <div class="flex-1 p-4 bg-slate-50 rounded-xl border">
                                            <h6 class="text-[10px] font-bold text-slate-500 uppercase">Minimum Run Time</h6>
                                            <p class="text-xs text-slate-600 mt-1">Prevents mechanical wear from short-cycling.</p>
                                        </div>
                                        <div class="flex-1 p-4 bg-slate-50 rounded-xl border">
                                            <h6 class="text-[10px] font-bold text-slate-500 uppercase">Wet Stacking</h6>
                                            <p class="text-xs text-slate-600 mt-1">Low-load protection for exhaust health.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Inverter Efficiencies -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-10 items-start border-t pt-10">
                                <div>
                                    <div class="flex items-center gap-2 mb-4">
                                        <span class="physics-tag">Power Electronics</span>
                                        <h5 class="font-bold text-slate-900">Three-Part Loss Mapping</h5>
                                    </div>
                                    <p class="text-sm text-slate-600 leading-relaxed">
                                        Inverter efficiency is not a single number but a map of <b>Switching Losses</b> (constant frequency flips), <b>Ohmic Losses</b> (I^2R), and <b>Magnetic Losses</b> (core eddy currents).
                                    </p>
                                </div>
                                <div class="space-y-4">
                                    <div class="p-4 bg-blue-50 rounded-xl border border-blue-100">
                                        <h6 class="text-[10px] font-bold text-blue-600 uppercase">Clipping Physics</h6>
                                        <p class="text-xs text-blue-800">When DC input exceeds AC rating, "lost" energy manifests as localized heat on the DC bus.</p>
                                    </div>
                                    <div class="p-4 bg-blue-50 rounded-xl border border-blue-100">
                                        <h6 class="text-[10px] font-bold text-blue-600 uppercase">Reactive Support</h6>
                                        <p class="text-xs text-blue-800">Sacrifices real power (Watts) to provide VARs for grid voltage stability.</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Summary Table -->
                            <div class="border rounded-2xl overflow-hidden shadow-sm">
                                <table class="w-full bg-white">
                                    <thead class="bg-slate-50">
                                        <tr>
                                            <th>Component</th>
                                            <th>Physics Variable</th>
                                            <th>Practical Constraint</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-slate-100">
                                        <tr>
                                            <td class="font-bold">Battery</td>
                                            <td>Ion Diffusion / Resistance</td>
                                            <td>C-Rate Limiting: Prevents damage when cold/aged.</td>
                                        </tr>
                                        <tr>
                                            <td class="font-bold">Diesel</td>
                                            <td>Thermal Equilibrium</td>
                                            <td>Spinning Reserve: Maintains inertia for stability.</td>
                                        </tr>
                                        <tr>
                                            <td class="font-bold">Inverter</td>
                                            <td>Junction Temperature</td>
                                            <td>Efficiency Mapping: Optimizes power electronic lifespan.</td>
                                        </tr>
                                        <tr>
                                            <td class="font-bold">System</td>
                                            <td>Kirchhoff’s Laws</td>
                                            <td>Power Balance: Gen + Storage Discharge = Load + Losses.</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>

        <!-- SECTION: SIMULATION -->
        <div id="section-simulation" class="hidden-section flex h-full">
            <aside class="w-80 bg-white border-r flex flex-col overflow-hidden">
                <div class="p-6 border-b shrink-0">
                    <h2 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-4">Environment Parameters</h2>
                    <div class="space-y-6">
                        <div>
                            <div class="flex justify-between text-xs font-medium mb-2">
                                <span>Solar Intensity</span>
                                <span id="v-sol" class="text-amber-500 font-bold">60%</span>
                            </div>
                            <input type="range" id="s-sol" class="w-full" min="0" max="100" value="60">
                        </div>
                        <div>
                            <div class="flex justify-between text-xs font-medium mb-2">
                                <span>Wind Magnitude</span>
                                <span id="v-wnd" class="text-blue-400 font-bold">30%</span>
                            </div>
                            <input type="range" id="s-wnd" class="w-full" min="0" max="100" value="30">
                        </div>
                        <div>
                            <div class="flex justify-between text-xs font-medium mb-2">
                                <span>Base Load Demand</span>
                                <span id="v-lod" class="text-rose-500 font-bold">50 kW</span>
                            </div>
                            <input type="range" id="s-lod" class="w-full" min="10" max="150" value="50">
                        </div>
                    </div>
                </div>

                <div class="flex-1 overflow-y-auto p-6 custom-scroll space-y-8">
                    <div>
                        <h2 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-4">Hardware Config</h2>
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between text-xs font-medium mb-2">
                                    <span>Battery Capacity</span>
                                    <span id="v-bat" class="text-emerald-500 font-bold">200 kWh</span>
                                </div>
                                <input type="range" id="s-bat" class="w-full" min="50" max="1000" value="200">
                            </div>
                        </div>
                    </div>

                    <div class="pt-4 space-y-2">
                        <button id="btn-grid" class="w-full py-3 rounded-xl bg-black text-white text-xs font-bold uppercase tracking-widest hover:bg-slate-800 transition">Toggle Power Grid</button>
                        <button id="btn-storm" class="w-full py-3 rounded-xl bg-slate-800 text-white text-xs font-bold uppercase tracking-widest hover:bg-slate-900 transition">Simulate Storm</button>
                        <button id="btn-reset" class="w-full py-3 rounded-xl border border-rose-200 text-rose-600 text-xs font-bold uppercase tracking-widest hover:bg-rose-50 transition">Factory Reset</button>
                    </div>
                </div>
            </aside>

            <!-- Main Display Area -->
            <section class="flex-1 flex flex-col overflow-hidden p-6 gap-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 shrink-0">
                    <div class="glass-panel p-5 rounded-2xl stat-card">
                        <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1">Operational Cost</p>
                        <p id="stat-cost" class="text-2xl font-bold">$0.00</p>
                    </div>
                    <div class="glass-panel p-5 rounded-2xl stat-card">
                        <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1">Baseline Comparison</p>
                        <p id="stat-baseline" class="text-2xl font-bold text-slate-400">$0.00</p>
                    </div>
                    <div class="glass-panel p-5 rounded-2xl stat-card border-l-4 border-l-emerald-500">
                        <p class="text-[10px] font-bold text-emerald-600 uppercase tracking-widest mb-1">Total Savings</p>
                        <p id="stat-savings" class="text-2xl font-bold text-emerald-600">$0.00</p>
                    </div>
                </div>

                <div class="flex-1 min-h-0 flex flex-col gap-6">
                    <div class="h-[45%] glass-panel p-6 rounded-2xl flex flex-col min-h-0">
                        <div class="flex justify-between items-center mb-4 shrink-0">
                            <h3 class="text-sm font-bold">Power Dispatch Profile (24h)</h3>
                            <div class="flex gap-4 text-[10px] font-bold">
                                <span class="flex items-center gap-1"><i class="fa-solid fa-circle text-amber-500"></i> SOLAR</span>
                                <span class="flex items-center gap-1"><i class="fa-solid fa-circle text-rose-500"></i> LOAD</span>
                                <span class="flex items-center gap-1"><i class="fa-solid fa-square text-blue-400"></i> GRID</span>
                            </div>
                        </div>
                        <div class="flex-1 min-h-0 relative">
                            <canvas id="pwrChart"></canvas>
                        </div>
                    </div>

                    <div class="flex-1 glass-panel p-6 rounded-2xl flex flex-col min-h-0">
                        <div class="flex justify-between items-center mb-4 shrink-0">
                            <h3 class="text-lg font-extrabold text-slate-800">Battery State of Charge (%)</h3>
                            <div class="text-[10px] font-bold text-emerald-600 bg-emerald-50 px-2 py-1 rounded">STORAGE CAPACITY MONITOR</div>
                        </div>
                        <div class="flex-1 min-h-0 relative">
                            <canvas id="socChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <script>
        let gridActive = true;
        let pChart, sChart;

        function switchTab(tab) {
            const simSection = document.getElementById('section-simulation');
            const conSection = document.getElementById('section-concept');
            const tabSim = document.getElementById('tab-simulation');
            const tabCon = document.getElementById('tab-concept');

            if (tab === 'simulation') {
                simSection.classList.remove('hidden-section');
                conSection.classList.add('hidden-section');
                tabSim.classList.add('tab-active');
                tabSim.classList.remove('text-gray-400');
                tabCon.classList.remove('tab-active');
                tabCon.classList.add('text-gray-400');
                if (pChart) pChart.resize();
                if (sChart) sChart.resize();
            } else {
                simSection.classList.add('hidden-section');
                conSection.classList.remove('hidden-section');
                tabCon.classList.add('tab-active');
                tabCon.classList.remove('text-gray-400');
                tabSim.classList.remove('tab-active');
                tabSim.classList.add('text-gray-400');
            }
        }

        const inputs = {
            sol: document.getElementById('s-sol'),
            wnd: document.getElementById('s-wnd'),
            lod: document.getElementById('s-lod'),
            bat: document.getElementById('s-bat')
        };

        const view = {
            vSol: document.getElementById('v-sol'),
            vWnd: document.getElementById('v-wnd'),
            vLod: document.getElementById('v-lod'),
            vBat: document.getElementById('v-bat'),
            statCost: document.getElementById('stat-cost'),
            statBaseline: document.getElementById('stat-baseline'),
            statSavings: document.getElementById('stat-savings'),
            statusPill: document.getElementById('status-pill')
        };

        function calculateSimulation() {
            const T = Array.from({length: 24}, (_, i) => i);
            const solVal = parseFloat(inputs.sol.value);
            const wndVal = parseFloat(inputs.wnd.value);
            const lodVal = parseFloat(inputs.lod.value);
            const cap = parseFloat(inputs.bat.value);
            const pHigh = 0.35;
            const pLow = 0.12;
            const eff = 0.95;

            const solar = T.map(h => solVal * Math.exp(-Math.pow(h - 12, 2) / (2 * Math.pow(2.5, 2))));
            const wind = T.map(h => wndVal * (0.7 + 0.3 * Math.cos(h / 3)));
            const load = T.map(h => lodVal * (1 + 0.8 * Math.exp(-Math.pow(h - 19, 2) / 5) + 0.5 * Math.exp(-Math.pow(h - 8, 2) / 3)));
            
            let soc = 50.0;
            let socHist = [];
            let gridHist = [];
            let cost = 0, baseline = 0;

            for (let h = 0; h < 24; h++) {
                let isPeak = (h >= 17 && h <= 21);
                let price = isPeak ? pHigh : pLow;
                let net = (solar[h] + wind[h]) - load[h];
                if (net < 0) baseline += Math.abs(net) * price;

                let pGrid = 0, pBatt = 0;
                if (!gridActive) {
                    pBatt = Math.max(-(soc - (cap * 0.1)), Math.min(net, (cap * 0.95 - soc)));
                } else {
                    if (isPeak && net < 0) pBatt = Math.max(net, -(soc - (cap * 0.1)));
                    else if (net > 0) pBatt = Math.min(net, (cap * 0.95 - soc));
                    pGrid = -(net - pBatt);
                }

                if (pBatt > 0) soc += pBatt * eff; else soc += pBatt / eff;
                socHist.push((soc / cap) * 100);
                gridHist.push(pGrid);
                cost += Math.max(0, pGrid) * price;
            }
            return { T, solar, load, gridHist, socHist, cost, baseline };
        }

        function refreshSimulation() {
            const d = calculateSimulation();
            view.vSol.innerText = inputs.sol.value + "%";
            view.vWnd.innerText = inputs.wnd.value + "%";
            view.vLod.innerText = inputs.lod.value + " kW";
            view.vBat.innerText = inputs.bat.value + " kWh";
            view.statCost.innerText = `$${d.cost.toFixed(2)}`;
            view.statBaseline.innerText = `$${d.baseline.toFixed(2)}`;
            view.statSavings.innerText = `$${(d.baseline - d.cost).toFixed(2)}`;

            if(gridActive) {
                view.statusPill.innerHTML = `<span class="relative flex h-2 w-2"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-slate-400 opacity-75"></span><span class="relative inline-flex rounded-full h-2 w-2 bg-slate-500"></span></span> SYSTEM ONLINE`;
            } else {
                view.statusPill.innerHTML = `<i class="fa-solid fa-triangle-exclamation text-rose-500"></i> ISLANDED MODE`;
            }

            pChart.data.datasets[0].data = d.solar;
            pChart.data.datasets[1].data = d.load;
            pChart.data.datasets[2].data = d.gridHist;
            pChart.update('none');

            sChart.data.datasets[0].data = d.socHist;
            sChart.update('none');
        }

        function initSimulation() {
            const ctxP = document.getElementById('pwrChart').getContext('2d');
            pChart = new Chart(ctxP, {
                type: 'line',
                data: {
                    labels: Array.from({length: 24}, (_, i) => i + "h"),
                    datasets: [
                        { label: 'Solar Output', data: [], borderColor: '#f59e0b', backgroundColor: 'rgba(245, 158, 11, 0.1)', fill: true, tension: 0.4, borderWidth: 2, pointRadius: 0 },
                        { label: 'Building Load', data: [], borderColor: '#f43f5e', borderDash: [5, 5], tension: 0.4, borderWidth: 2, pointRadius: 0 },
                        { label: 'Grid Exchange', data: [], type: 'bar', backgroundColor: 'rgba(59, 130, 246, 0.4)', borderRadius: 4 }
                    ]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    plugins: { legend: { display: false } },
                    scales: { 
                        y: { grid: { color: '#f1f5f9' }, ticks: { font: { size: 10 } } },
                        x: { grid: { display: false }, ticks: { font: { size: 10 } } }
                    } 
                }
            });

            const ctxS = document.getElementById('socChart').getContext('2d');
            sChart = new Chart(ctxS, {
                type: 'line',
                data: {
                    labels: Array.from({length: 24}, (_, i) => i + "h"),
                    datasets: [{ label: 'Battery SoC', data: [], borderColor: '#10b981', backgroundColor: 'rgba(16, 185, 129, 0.05)', fill: true, tension: 0.2, pointRadius: 4, pointBackgroundColor: '#10b981', borderWidth: 3 }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    plugins: { legend: { display: false } },
                    scales: { 
                        y: { min: 0, max: 100, grid: { color: '#f1f5f9' }, ticks: { font: { size: 11, weight: '600' } } },
                        x: { grid: { display: false }, ticks: { font: { size: 11 } } }
                    } 
                }
            });

            Object.values(inputs).forEach(i => i.addEventListener('input', refreshSimulation));
            document.getElementById('btn-grid').onclick = () => { gridActive = !gridActive; refreshSimulation(); };
            document.getElementById('btn-storm').onclick = () => { inputs.sol.value = 5; gridActive = false; refreshSimulation(); };
            document.getElementById('btn-reset').onclick = () => { 
                inputs.sol.value = 60; inputs.wnd.value = 30; inputs.lod.value = 50; inputs.bat.value = 200;
                gridActive = true; refreshSimulation(); 
            };
            refreshSimulation();
        }

        window.onload = initSimulation;
    </script>
</body>
</html>